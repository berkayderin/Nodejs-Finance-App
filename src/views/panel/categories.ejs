<div
	x-data="{ 
		categories: [],
		editingCategory: null,
		deleteConfirmModal: false,
		categoryToDelete: null,
		categoryModal: false,
		categoryForm: {
			name: '',
			description: ''
		},
		async getCategories() {
			try {
				const response = await fetch('/api/categories')
				const data = await response.json()
				this.categories = data
			} catch (error) {
				console.error('Kategoriler yüklenirken hata:', error)
			}
		},
		async submitCategory() {
			try {
				const url = this.editingCategory 
					? `/api/categories/${this.editingCategory.id}`
					: '/api/categories'
				
				const method = this.editingCategory ? 'PUT' : 'POST'
				
				const response = await fetch(url, {
					method,
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(this.categoryForm)
				})
				
				if (response.ok) {
					this.categoryModal = false
					this.categoryForm = { name: '', description: '' }
					this.editingCategory = null
					this.getCategories()
				}
			} catch (error) {
				console.error('Kategori işlemi sırasında hata:', error)
			}
		},
		editCategory(category) {
			this.editingCategory = category
			this.categoryForm = {
				name: category.name,
				description: category.description || ''
			}
			this.categoryModal = true
		},
		async deleteCategory() {
			if (!this.categoryToDelete) return
			
			try {
				const response = await fetch(`/api/categories/${this.categoryToDelete.id}`, {
					method: 'DELETE'
				})
				
				if (response.ok) {
					this.deleteConfirmModal = false
					this.categoryToDelete = null
					this.getCategories()
				}
			} catch (error) {
				console.error('Kategori silinirken hata:', error)
			}
		},
		confirmDelete(category) {
			this.categoryToDelete = category
			this.deleteConfirmModal = true
		},
		resetForm() {
			this.categoryForm = { name: '', description: '' }
			this.editingCategory = null
			this.categoryModal = true
		}
	}"
	x-init="getCategories"
>
	<div class="sm:flex sm:items-center">
		<div class="sm:flex-auto">
			<h1 class="text-base font-semibold leading-6 text-gray-900">Kategoriler</h1>
			<p class="mt-2 text-sm text-gray-700">Tüm kategorilerinizi görüntüleyin ve yönetin.</p>
		</div>
		<div class="mt-4 sm:mt-0 sm:flex-none flex items-center gap-4">
			<!-- Dışa Aktarma Dropdown -->
			<div class="relative" x-data="{ open: false }">
				<button
					@click="open = !open"
					type="button"
					class="inline-flex items-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"
				>
					<svg class="-ml-0.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
						<path
							d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z"
						/>
						<path
							d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z"
						/>
					</svg>
					Dışa Aktar
					<svg class="-mr-1 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
						<path
							fill-rule="evenodd"
							d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
							clip-rule="evenodd"
						/>
					</svg>
				</button>
				<div
					x-show="open"
					@click.away="open = false"
					class="absolute right-0 z-10 mt-2 w-40 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
					role="menu"
					aria-orientation="vertical"
					aria-labelledby="menu-button"
					tabindex="-1"
				>
					<div class="py-1" role="none">
						<a
							href="/api/export/categories?format=excel"
							class="text-gray-700 group flex items-center px-4 py-2 text-sm hover:bg-gray-100 hover:text-gray-900"
							role="menuitem"
							tabindex="-1"
						>
							<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" viewBox="0 0 20 20" fill="currentColor">
								<path
									fill-rule="evenodd"
									d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm2.25 8.5a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 3a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z"
									clip-rule="evenodd"
								/>
							</svg>
							Excel
						</a>
						<a
							href="/api/export/categories?format=pdf"
							class="text-gray-700 group flex items-center px-4 py-2 text-sm hover:bg-gray-100 hover:text-gray-900"
							role="menuitem"
							tabindex="-1"
						>
							<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" viewBox="0 0 20 20" fill="currentColor">
								<path
									fill-rule="evenodd"
									d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm2.25 8.5a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 3a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z"
									clip-rule="evenodd"
								/>
							</svg>
							PDF
						</a>
					</div>
				</div>
			</div>
			<button
				@click="resetForm()"
				class="inline-flex items-center justify-center rounded-md border border-transparent bg-primary-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 sm:w-auto"
			>
				Yeni Kategori
			</button>
		</div>
	</div>

	<!-- Kategori Listesi -->
	<div class="mt-8 flow-root">
		<div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
			<div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
				<div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
					<table class="min-w-full divide-y divide-gray-300">
						<thead class="bg-gray-50">
							<tr>
								<th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">
									Kategori Adı
								</th>
								<th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Açıklama</th>
								<th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
									Oluşturulma Tarihi
								</th>
								<th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
									<span class="sr-only">İşlemler</span>
								</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-gray-200 bg-white">
							<template x-if="categories.length === 0">
								<tr>
									<td colspan="4" class="py-8">
										<div class="flex items-center justify-center text-center">
											<div>
												<svg
													class="mx-auto h-12 w-12 text-gray-400"
													fill="none"
													viewBox="0 0 24 24"
													stroke="currentColor"
												>
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
													/>
												</svg>
												<h3 class="mt-2 text-sm font-medium text-gray-900">Kategori Yok</h3>
												<p class="mt-1 text-sm text-gray-500">Henüz hiç kategori oluşturmadınız.</p>
												<div class="mt-6">
													<button
														type="button"
														@click="categoryModal = true"
														class="inline-flex items-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
													>
														<svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
															<path
																fill-rule="evenodd"
																d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
																clip-rule="evenodd"
															/>
														</svg>
														Yeni Kategori Ekle
													</button>
												</div>
											</div>
										</div>
									</td>
								</tr>
							</template>
							<template x-if="categories.length > 0">
								<template x-for="category in categories" :key="category.id">
									<tr>
										<td
											class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6"
											x-text="category.name"
										></td>
										<td
											class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
											x-text="category.description || '-'"
										></td>
										<td
											class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
											x-text="new Date(category.createdAt).toLocaleDateString('tr-TR')"
										></td>
										<td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
											<button
												@click="editCategory(category)"
												class="text-primary-600 hover:text-primary-900 mr-4"
											></button>
											<button @click="confirmDelete(category)" class="text-red-600 hover:text-red-900"></button>
										</td>
									</tr>
								</template>
							</template>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- Kategori Modal -->
	<div
		x-show="categoryModal"
		class="relative z-10"
		aria-labelledby="modal-title"
		role="dialog"
		aria-modal="true"
		x-cloak
	>
		<div
			x-show="categoryModal"
			x-transition:enter="ease-out duration-300"
			x-transition:enter-start="opacity-0"
			x-transition:enter-end="opacity-100"
			x-transition:leave="ease-in duration-200"
			x-transition:leave-start="opacity-100"
			x-transition:leave-end="opacity-0"
			class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
		></div>

		<div class="fixed inset-0 z-10 overflow-y-auto">
			<div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
				<div
					x-show="categoryModal"
					x-transition:enter="ease-out duration-300"
					x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
					x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
					x-transition:leave="ease-in duration-200"
					x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
					x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
					class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"
				>
					<div>
						<h3
							class="text-lg font-medium leading-6 text-gray-900 mb-4"
							x-text="editingCategory ? 'Kategori Düzenle' : 'Yeni Kategori'"
						></h3>
						<form @submit.prevent="submitCategory">
							<div class="space-y-4">
								<div>
									<label for="name" class="block text-sm font-medium text-gray-700">Kategori Adı</label>
									<input
										type="text"
										name="name"
										id="name"
										x-model="categoryForm.name"
										required
										class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
									/>
								</div>
								<div>
									<label for="description" class="block text-sm font-medium text-gray-700">Açıklama</label>
									<textarea
										name="description"
										id="description"
										x-model="categoryForm.description"
										rows="3"
										class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"
									></textarea>
								</div>
							</div>
							<div class="mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3">
								<button
									type="submit"
									class="inline-flex w-full justify-center rounded-md bg-primary-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 sm:col-start-2"
									x-text="editingCategory ? 'Güncelle' : 'Kaydet'"
								></button>
								<button
									type="button"
									@click="categoryModal = false"
									class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:col-start-1 sm:mt-0"
								>
									İptal
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Silme Onay Modal -->
	<div
		x-show="deleteConfirmModal"
		class="relative z-10"
		aria-labelledby="modal-title"
		role="dialog"
		aria-modal="true"
		x-cloak
	>
		<div
			x-show="deleteConfirmModal"
			x-transition:enter="ease-out duration-300"
			x-transition:enter-start="opacity-0"
			x-transition:enter-end="opacity-100"
			x-transition:leave="ease-in duration-200"
			x-transition:leave-start="opacity-100"
			x-transition:leave-end="opacity-0"
			class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
		></div>

		<div class="fixed inset-0 z-10 overflow-y-auto">
			<div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
				<div
					x-show="deleteConfirmModal"
					x-transition:enter="ease-out duration-300"
					x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
					x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
					x-transition:leave="ease-in duration-200"
					x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
					x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
					class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"
				>
					<div class="sm:flex sm:items-start">
						<div
							class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
						>
							<svg
								class="h-6 w-6 text-red-600"
								fill="none"
								viewBox="0 0 24 24"
								stroke-width="1.5"
								stroke="currentColor"
								aria-hidden="true"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
								/>
							</svg>
						</div>
						<div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
							<h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Kategori Silme</h3>
							<div class="mt-2">
								<p class="text-sm text-gray-500">
									<span x-text="categoryToDelete?.name"></span>
									kategorisini silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.
								</p>
							</div>
						</div>
					</div>
					<div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
						<button
							type="button"
							@click="deleteCategory()"
							class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto"
						>
							Sil
						</button>
						<button
							type="button"
							@click="deleteConfirmModal = false"
							class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
						>
							İptal
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	[x-cloak] {
		display: none !important;
	}
</style>
